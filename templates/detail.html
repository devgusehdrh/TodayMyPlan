<!doctype html>
<html lang="en">
    <head>

        <!-- Webpage Title -->
        <title>오늘 뭐하지?</title>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Single+Day&display=swap" rel="stylesheet">
        <!-- Bulma CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
        <!-- Font Awesome CSS -->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                crossorigin="anonymous"></script>

        <!-- JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

        <style>
                .section {
                padding: 1rem 1.5rem;
                max-width: 750px;
                margin: auto;
                }

                .title {
                font-weight: 800;
                font-size: 5rem;
                font-family: 'Gamja Flower', cursive;
                font-family: 'Single Day', cursive;
                }

                .subtitle {
                font-size: 2rem;
                }

                .is-sparta {
                color: #0bb068 !important;
                font-family: 'Gamja Flower', cursive;
                }

                .button.is-sparta {
                    background-color: #0bb068;
                    border-color: transparent;
                    color: #fff !important;
                }

                .button.del {
                    background-color: #ec878e;
                    border-color: transparent;
                    color: #fff !important;
                }

                .button.comment {
                    background-color: #0bb068;
                    border-color: transparent;
                    color: #fff !important;
                }

                .button.is-sparta.is-outlined {
                    background-color: transparent;
                    border-color: #0bb068;
                    color: #0bb068 !important;
                }


                .help {
                    color: gray;
                }

                .btn-top {
                    margin-top: 1rem;
                    margin-right: 0.5rem;
                }

                .mypost {
                    width: 95%;
                    max-width: 500px;
                    margin: 20px auto 20px auto;

                    box-shadow: 0px 0px 3px 0px black;
                    padding: 20px;
                }

                .mypost > button {
                    margin-top: 15px;
                }

                .mycards {

                    width: 95%;
                    max-width: 800px;
                    margin: 20px auto 20px auto;

                }

                .card {
                    box-shadow: 0px 0px 3px 0px black;
                }

                .col {
                    margin: 20px auto 20px auto;
                }

        </style>
        <script>
            let plan_no = '{{ plan_no }}'
            $(document).ready(function(){
                show_plan();
            });


            function sign_out() {
                $.removeCookie('mytoken', {path: '/'});
                alert('로그아웃 되셨습니다')
                window.location.href = "/"
            }

            {# 세부 목록 보기#}
            function show_plan() {
                 $.ajax({
                    type: "get",
                    url: `/detail/${plan_no}"`,
                    data: {},
                    success: function (response){
                    }
                });
            }

            function save_comment() {
                let Mycomment = $('#comment').val()

                 $.ajax({
                    type: "POST",
                    url: `/detail/comment-registration`,
                    data: { comment_give: Mycomment,
                            plan_no_give: plan_no
                    },
                    success: function (response) {
                        alert(response["msg"])
                        window.location.reload()

                    }
                });
            }

            function delete_comment() {
                const uncomment = confirm('댓글을 정말 삭제 할까요?')

                if (uncomment == true) {
                    $.ajax({
                        type: "DELETE",
                        url: `/detail/comment-delete`,
                        data: {},
                        success: function (response) {
                            alert(response["msg"])
                            window.location.reload()

                        }
                    })
                }
            }

            function modify_comment() {
                const modcomment = confirm('댓글을 정말 수정 할까요?')

                if (modcomment == true) {
                    $.ajax({
                        type: "DELETE",
                        url: `/detail/comment-delete`,
                        data: {},
                        success: function (response) {
                            alert(response["msg"])
                            window.location.reload()
                        }
                    })
                }
            }

         </script>

    </head>
    <body>
    <nav id="btns-top" class="level-right is-mobile btn-top">
        <a>
            <button class="button is-light logout" onclick="sign_out()">로그아웃</button>
        </a>
    </nav>
        <section class="hero is-white">
            <div class="hero-body has-text-centered" style="padding-bottom:1rem;margin:auto;">
{#                타이틀 클릭시 로그인 페이지 리다이렉션#}
                <h1 class="title is-sparta" onclick='window.location.replace("/")'>오늘 뭐하지?</h1>
            </div>
        </section>
        <section class="hero is-white">
            <div class="card text-center" style="margin:auto" >
                <div class="card-header is-sparta text-center" style="font-size:2rem">
                    {{ user_post['nickname'] }} 님의 오늘 계획입니다
                </div>
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1.5rem">{{ user_post['my_plan'] }}</h5>
                </div>
            </div>
        </section>
        <section class="hero is-white" id="plan">

        </section>
         <section class="hero is-white">
            <div class="mypost">
                <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="comment"
                              style="height: 100px"></textarea>
                    <label for="floatingTextarea2">댓글을 남겨주세요</label>
                </div>
                <button onclick="save_comment()" type="button" class="button comment">댓글 남기기</button>
            </div>
         <div>
             {% for comment in comments %}
                 {% if comment.plan_no == plan_no %}
                     <div class="mycards" id="comment-list">
                             <div class="col">
                                 <div class="card">
                                     <div class="card-body">
                                         <h5 class="card-title"> {{ comment.nickname }}님의 댓글입니다.</h5>
                                         <p class="card-text"> {{ comment.comment }} </p>
                                         <p id="comment_time"> {{ comment.registraion_time }} </p>
                                         <p id="plan_no" style="display:none"> {{ comment.plan_no }} </p>
                                         <p id="comment_no" style="display:none"> {{ comment.comment_no }} </p>
                                     </div>
                                     <div>
                                        {# 로그인 유저 id와 댓글 작성 유저 id가 동일할 시 수정, 삭제 버튼 표시 #}
                                         {% if comment.nickname == user_info.nickname %}
                                             <button onclick="modify_comment()" type="button" class="button del">수정
                                             </button>
                                             <button onclick="delete_comment()" type="button" class="button del">삭제
                                             </button>
                                         {% endif %}
                                     </div>
                                 </div>
                             </div>
                     </div>
                 {% endif %}
             {% endfor %}
         </div>
         </section>
    </body>
</html>